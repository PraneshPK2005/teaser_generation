import re
from itertools import groupby

# -------------------------------
# Audio Preprocessing
# -------------------------------
def preprocess_audio(audio_transcripts):
    """
    Preprocess audio transcripts by removing filler phrases and consecutive duplicates.
    
    Args:
        audio_transcripts (list): List of transcript strings with timestamps
    
    Returns:
        list: List of dictionaries with 'timestamp' and 'text' keys
    """
    
    def clean_text(text):
        # Remove common filler words like "um", "uh", "you know", "like", "actually"
        text = re.sub(r'\b(um|uh|you know|like|actually)\b', '', text, flags=re.IGNORECASE)
        # Replace multiple spaces with single space
        text = re.sub(r'\s+', ' ', text)
        return text.strip()
    
    cleaned = []
    for t in audio_transcripts:
        try:
            timestamp, text = t.split(']', 1)
            timestamp = timestamp + ']'  # add closing bracket
            text = clean_text(text)
            cleaned.append({"timestamp": timestamp, "text": text})
        except ValueError:
            continue  # skip malformed entries
    
    # Remove consecutive duplicates
    unique = [next(group) for _, group in groupby(cleaned, key=lambda x: x["text"])]
    
    return unique



if __name__ == "__main__":
    # Replace these with your actual data
    audio_transcripts =["[0.00s - 4.23s]  Not only am I going to review an older movie for you guys, but I'm going to review one", '[4.23s - 6.22s]  of my favorite movies, as in like, ever.', '[11.52s - 13.16s]  Terminator 2, Judgment Day.', "[13.24s - 15.90s]  I know what some of you are thinking right now, you're like, wait, Terminator 2, where's", '[15.90s - 16.58s]  Terminator 1?', '[16.72s - 19.60s]  I wanted to go straight for the throat on this one, I wanted to review one of my favorite', '[19.68s - 20.40s]  movies of all time.', "[20.46s - 22.32s]  But I'm not going to leave you hanging, here's a bit of the backstory.", '[22.40s - 27.47s]  In Terminator Lore, on August 29th, 1997, the machines we created became self-aware and', '[27.47s - 28.66s]  they pretty much wiped out mankind.', "[28.94s - 31.02s]  Uh, yeah, that didn't quite happen, but you know.", "[31.20s - 35.00s]  From that point of the year, 2029, mankind's been locked in a war with the machines.", '[35.18s - 38.60s]  The leader of this resistance is a man named John Conner and he actually leads mankind', '[38.66s - 39.16s]  to victory.', '[39.34s - 42.72s]  So in Terminator 1, the machines send a machine back in time to kill Sarah Connor.', '[42.82s - 45.58s]  Yeah, no Sarah Connor means no John Connor means the machines win.', '[45.76s - 47.34s]  And now we reach Terminator 2.', '[47.50s - 51.14s]  Machines kinda had to failsafe, they actually sent two Terminators back through time, one', '[51.18s - 55.04s]  back to the 80s to take out Sarah Connor, the other to the 90s to take out John Connor.', "[55.14s - 57.40s]  But don't worry, we humans were smart and we have a plan.", '[57.82s - 62.04s]  John Connor from the future reprograms the Terminator to protect him as a child in the 90s.', "[62.18s - 64.20s]  Now we have our movie and it's awesome.", "[64.30s - 67.58s]  There's so much I like about Terminator 2 1, it's exciting as hell.", "[67.58s - 71.06s]  In the first movie, you have a soldier who's protecting Sarah Connor from a Terminator.", "[71.18s - 73.08s]  So they can't really scrap in that movie.", '[73.18s - 76.36s]  A hand-to-hand fight will be like Terminator going boom, dun dun dun dun.', "[76.48s - 78.30s]  Well, there's his head, uh, he's dead, I win.", "[78.42s - 82.74s]  But in Terminator 2, you have Arnold Schwarzenegger, a T-800 machine, same model that's in Terminator", '[82.88s - 85.64s]  1, and you have Robert Patrick playing the T-1000.', "[86.12s - 89.50s]  So you can have them throw each other through walls and they're not gonna die from it.", "[89.52s - 91.28s]  You're just gonna be absurdly entertained by it.", '[91.32s - 96.56s]  And as for the T-1000, the T-1000 in Terminator 2 remains one of the deadliest bastards ever', '[96.68s - 97.26s]  put in a movie.', '[97.38s - 101.10s]  This guy was just death incarnate and he was revolutionary for the time.', "[101.24s - 104.42s]  He's made completely out of liquid metal so he can change his appearance, he can look", '[104.52s - 107.44s]  like anyone, he can turn his arms into knives and stabbing weapons.', "[107.60s - 109.87s]  I know that is common, now you're like, I've seen that before.", "[109.87s - 113.14s]  But in 1991, that was absurd, that hadn't been done before.", '[113.32s - 116.40s]  After you watch Terminator 2 Judgment Day, T-1000 is in your mind.', "[116.54s - 120.33s]  You go to anyone and you're like, oh, iconic T-1000 moment, they're like, I have to pick one?", "[120.33s - 124.17s]  There's a scene where he gets frozen in liquid nitrogen, he's walking towards John Connor", "[124.17s - 127.20s]  and he's just like not stopping but he's slowly freezing and Arnold's all like,", "[129.04s - 131.44s]  That's like a staple cinema moment right there.", '[131.56s - 136.04s]  And what the T-1000 does in Terminator 2 remains to this day the coolest stuff any liquid metal', '[136.18s - 137.38s]  being has ever done in a movie.', '[137.50s - 141.54s]  And the excitement in this movie never stops, like Arnold Schwarzenegger and T-1000 fight', '[141.74s - 142.10s]  in a mall.', "[142.64s - 146.24s]  Then T-1000 chases John Connor on foot, then he gets in a semi and he's going after John", '[146.28s - 147.50s]  Connor on his little motorcycle.', "[147.76s - 151.42s]  Then Arnold's pursuing the semi on his motorcycle trying to get to John Connor.", "[151.52s - 154.73s]  That's just one of the many action sequences in Terminator 2 that are just like, dude,", "[154.73s - 155.50s]  that's just the best.", '[155.68s - 159.98s]  And above it being exciting and having this revolutionary T-1000 character, the human', '[160.10s - 161.46s]  characters themselves are deeper.', "[161.62s - 165.60s]  In Terminator 1, Kyle Reese, the soldier who's protecting Sarah Connor, kind of burdened", '[165.60s - 168.72s]  her with knowledge and let her know that the human race is going to be incinerated and', '[168.72s - 170.12s]  machines are going to take over the world.', "[170.38s - 172.88s]  And she let that slip to a few people, now people think she's crazy.", "[173.02s - 176.86s]  So she's in a mental institution and she is not the Sarah Connor from Terminator 1.", "[176.98s - 180.76s]  T-1000, she's Susie Homemaker, she's a waitress, she's like, oh, I'm no one special.", "[181.04s - 184.50s]  Now for the past decade, she's been training, doing pushups, becoming all hardcore.", "[184.80s - 186.70s]  She's actually quite the badass in Terminator 2.", "[186.76s - 189.74s]  She's not Susie Homemaker, she's Susie Kill You With My Pinkie.", "[189.78s - 190.52s]  She's nuts, man.", "[190.64s - 194.58s]  And in the world of Terminator 2 being a little deeper than you think it might be, there's", "[194.58s - 198.38s]  a scene where Sarah Connor learns about the guy who's going to ultimately cause Judgment", '[198.46s - 198.60s]  Day.', "[199.46s - 200.60s]  And she's on a quest to wipe this guy out.", '[200.64s - 201.24s]  I mean, why not?', '[201.26s - 202.86s]  She kills him, she changes the future.', '[202.96s - 204.18s]  The robots never take over.', "[204.30s - 206.84s]  At that point, she's a Terminator to this guy.", "[206.98s - 210.46s]  She might not be a machine like the other Terminators, but she's on a quest to kill", '[210.56s - 211.62s]  someone to change the future.', '[211.76s - 213.12s]  I just, I like that little detail.', "[213.26s - 216.18s]  And to any and all you girls out there who are like, yeah, Terminator 2, I don't know,", "[216.18s - 217.73s]  it's just a Sky Movie, it's just a Sky Movie.", "[217.73s - 219.12s]  Here's a story, true story.", '[219.24s - 220.82s]  I knew this girl who said the same thing.', "[220.82s - 224.30s]  She was like, I have no interest in Terminator 2, it's a Sky Movie, what would I like about", '[224.30s - 224.50s]  it?', '[224.96s - 228.42s]  I loaned her my copy, I was like, watch it, I will bet you that you will love it, not', '[228.46s - 230.78s]  only will you love it, you might even cry at the end.', '[230.84s - 232.52s]  I still, dude, man tears at the end, seriously.', '[232.52s - 234.76s]  She returned it, she was like, oh my God, it was so good.', '[234.84s - 236.26s]  You were just right, it was so good.', "[236.32s - 238.49s]  Yeah, I don't mess around about that shit.", '[238.49s - 241.28s]  Terminator 2 Judgment Day ends Terminator lore for me.', '[241.36s - 243.96s]  The Terminator saga is Terminator 1 and Terminator 2.', '[244.04s - 245.46s]  After that, nothing is canon.', "[245.54s - 248.90s]  It'll be light entertainment at best, but in the end, it ends at Terminator 2.", '[249.02s - 252.98s]  And in Terminator 2, being one of my favorite movies of all time, if I were to make a top', '[253.02s - 255.14s]  10 list, it has to be on there somewhere.', '[255.70s - 258.84s]  Terminator 2 Judgment Day is awesome-tacular.', '[263.92s - 267.60s]  If someone had a gun to my head and was like, best Cameron movie ever, you have to say one,', "[267.66s - 268.86s]  I'd be like, oh, T2, definitely.", "[269.04s - 271.14s]  And I'm pretty sure I would live through the situation.", '[271.30s - 274.64s]  So your favorite Terminator movie out there, you gotta have one.', '[274.84s - 275.38s]  What is it?', '[275.52s - 276.88s]  Comment below, let me know.', "[277.04s - 280.26s]  And as always, if you like what you've seen here and you want to see more, click right", '[280.32s - 281.14s]  here to see more.', '[281.28s - 282.88s]  Hasta la vista, baby.', '[285.70s - 285.80s]  Bye.', '[286.20s - 286.22s]  Bye.', '[287.20s - 287.84s]  Bye.', '[289.14s - 289.16s]  Bye.', '[289.86s - 290.10s]  Bye.', '[291.58s - 291.60s]  Bye.', '[292.24s - 292.26s]  Bye.', '[293.10s - 293.14s]  Bye.', '[293.20s - 293.74s]  Bye.']

    audio_data = preprocess_audio(audio_transcripts)

    print(audio_data)